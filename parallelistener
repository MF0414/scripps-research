#!/bin/bash

# Ensure we only read from the second line
# Change the field separator
new=','
IFS=$new
echo $new
let num=1
let offsetStart=0
let offset=400

while [ $offset -lt 4800 ]
do
   while read f
      # Simply increments for the next process
      # Skipping the first line in access keys file
      # The lines should still be displayed on the screen from cat
   do
     if [ $num -eq 1 ]
        then
          let num=$num+1
          echo $num                                    
     else
          let temp=$offsetStart                                # Set the temporary start
          let offset=offset+1                                  # Accounts for exclusive array processing in python
          #set $f					       # Split the variables
          line=$f
          set $line
          echo $1
          echo $2                                             
          python3 listener.py $2 $3 $4 $5 $temp $offset &      # Run the script as a separate process
          let offsetStart=offset			       # Change the id offset start for the next process
          let offset=offset+400                                # Increment the number of users to process
          echo "The new offsets are $offsetStart $offset"
       fi
    done < redirect.txt      # Extract only the token keys
done


    
    
